## ğŸ“Â express-validator

express-validatorëŠ” ìœ íš¨ì„± ê²€ì¦ì„ ë„ì™€ì£¼ëŠ” ëª¨ë“ˆì´ë‹¤.

[express-validator](https://express-validator.github.io/docs/guides/getting-started)

### âœ”ï¸Â ì˜ˆì‹œ ì½”ë“œ ì‚´í´ë³´ê¸°

ê³µì‹ë¬¸ì„œì—ì„œ ì œê³µí•˜ëŠ” ì˜ˆì‹œ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì„ ëŒ€ìƒìœ¼ë¡œ ìœ íš¨ì„± ê²€ì¦ì„ í•˜ëŠ” ê²½ìš°ì—ëŠ” `query` ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ìœ íš¨ì„± ê²€ì¦ì„ í•  ìˆ˜ ìˆë‹¤.

â†’ body ê°’ì„ ê²€ì¦í•˜ë ¤ë©´ `body`, paramsë¥¼ ê²€ì¦í•˜ë ¤ë©´ `param` ì„ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ìœ íš¨ì„± ê²€ì¦ ê²°ê³¼ëŠ” `validationResult` ë¥¼ í†µí•´ ì²´í¬í•  ìˆ˜ ìˆìœ¼ë©°, ìœ íš¨ì„± ê²€ì¦ ëŒ€ìƒì¸ ë°ì´í„°ê°€ ì—¬ëŸ¬ ê°œì¼ ìˆ˜ ìˆìŒì„ ê°ì•ˆí•˜ì—¬ ìœ íš¨ì„± ê²€ì¦ì„ í†µê³¼í•œ ë°ì´í„°ë§Œ ì¶”ì¶œí•˜ëŠ” `matchedData` ë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
const express = require("express");
const { query, matchedData, validationResult } = require("express-validator");
const app = express();

app.use(express.json());
app.get("/hello", query("person").notEmpty().escape(), (req, res) => {
  const result = validationResult(req); // ìœ íš¨ì„± ê²€ì¦ ê²°ê³¼

  if (result.isEmpty()) {
    const data = matchedData(req); // ìœ íš¨ì„± ê²€ì¦ì´ ì™„ë£Œëœ ë°ì´í„°
    return res.send(`Hello, ${data.person}!`);
  }

  res.send({ errors: result.array() });
});

app.listen(3000);
```

ì°¸ê³ ë¡œ `validationResult` ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°ì´í„°ë“¤ì´ ë‹´ê²¨ìˆë‹¤.

```jsx
{
  "errors": [
    {
      "location": "query",
      "msg": "Invalid value",
      "path": "person",
      "type": "field"
    }
  ]
}
```

### âœ”ï¸Â **Validation Chains**

ìœ íš¨ì„± ê²€ì¦ì„ ìœ„í•´ ì—¬ëŸ¬ê°€ì§€ ë©”ì†Œë“œë¥¼ í™œìš©í•˜ë‹¤ ë³´ë©´ ìœ íš¨ì„± ê²€ì¦ ì½”ë“œê°€ ì²´ì¸ì²˜ëŸ¼ ì—®ì—¬ì„œ ê¸¸ì–´ì§€ê²Œ ëœë‹¤.

```jsx
app.post(
  "/newsletter",
  // For the `email` field in `req.body`...
  body("email")
    // ...mark the field as optional
    .optional()
    // ...and when it's present, trim its value, then validate it as an email address
    .trim()
    .isEmail(),
  maybeSubscribeToNewsletter
);
```

ë§Œì•½ ì´ ìœ íš¨ì„± ê²€ì¦ ì½”ë“œê°€ ì—¬ëŸ¬ ê³³ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤ë©´, ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ ë¬¶ì–´ë³¼ ìˆ˜ ìˆë‹¤.

```jsx
const createEmailChain = () => body("email").isEmail();
app.post("/login", createEmailChain(), handleLoginRoute);
app.post(
  "/signup",
  createEmailChain().custom(checkEmailNotInUse),
  handleSignupRoute
);
```

<br/>

## ğŸ“Â ìœ íš¨ì„± ê²€ì¦

express-validatorë¥¼ ì´ìš©í•˜ì—¬ ìœ íš¨ì„± ê²€ì¦ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆë‹¤.

```jsx
// user id ê²€ì¦
const userIdValidation = () =>
  body("userId").notEmpty().isInt().withMessage("userIdê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");

// ì±„ë„ëª… ê²€ì¦
const channelNameValidation = () =>
  body("channelName")
    .notEmpty()
    .isString()
    .withMessage("ì±„ë„ëª…ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");

// ì±„ë„ id ê²€ì¦
const channelIdValidation = () =>
  param("id").notEmpty().isInt().withMessage("idê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
```

ì•„ë˜ì™€ ê°™ì´ ì ìš©í•˜ì˜€ìŒ!

```jsx
.post([userIdValidation(), channelNameValidation()], (req, res) => {
    const err = validationResult(req);

    // ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•˜ì§€ ëª»í•œ ê²½ìš°
    if (!err.isEmpty()) {
      return res.status(400).json({
        isSuccess: false,
        error: err.array(),
      });
    }

    const { channelName, userId } = req.body;
    const sql = `INSERT INTO channels (channel_name, user_id) VALUES (?, ?);`;
    const values = [channelName, userId];

    conn.query(sql, values, (err) => {
      if (err) {
        res.status(500).json({
          isSuccess: false,
          message: `ì±„ë„ ìƒì„±ì„ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`,
        });
      } else {
        res.status(201).json({
          isSuccess: true,
          message: `ì±„ë„ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`,
        });
      }
    });
  });
```

<br/>

## ğŸ“Â ë¯¸ë“¤ì›¨ì–´ë¡œ ë¶„ë¦¬í•˜ê¸°

ìœ íš¨ì„± ê²€ì‚¬ì— ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë‹¤ìŒ ì½”ë“œë¥¼ ë¯¸ë“¤ì›¨ì–´ë¡œ ë¶„ë¦¬í•˜ë ¤ê³  í•œë‹¤.

```jsx
const err = validationResult(req);

// ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•˜ì§€ ëª»í•œ ê²½ìš°
if (!err.isEmpty()) {
  return res.status(400).json({
    isSuccess: false,
    error: err.array(),
  });
}
```

ë¨¼ì € í™”ì‚´í‘œ í•¨ìˆ˜ í˜•íƒœë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë³€ìˆ˜ì— ë‹´ì•„ì„œ ëª¨ë“ˆí™”í•˜ëŠ”ë°,

ì´ë•Œ `next` ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ì—¬ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•œ ê²½ìš°ì—ëŠ” ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ í˜¹ì€ ì½œë°±ì„ ì‹¤í–‰í•˜ë„ë¡ ì²˜ë¦¬í•´ì£¼ì–´ì•¼ í•œë‹¤.

```jsx
/* ----- ìœ íš¨ì„± ê²€ì‚¬ ì²˜ë¦¬ ëª¨ë“ˆ ----- */
const validationCheck = (req, res, next) => {
  const err = validationResult(req);

  // ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•œ ê²½ìš°
  if (err.isEmpty()) {
    return next();
  }
  // í†µê³¼í•˜ì§€ ëª»í•œ ê²½ìš°
  else {
    return res.status(400).json({
      isSuccess: false,
      error: err.array(),
    });
  }
};
```

ê·¸ë¦¬ê³  callback ì „ì— ë©”ì†Œë“œì˜ ì²«ë²ˆì§¸ ì¸ìë¡œ ë‹´ì•„ì£¼ë©´ ë!

```jsx
router.route("/").get([userIdValidation(), validationCheck], (req, res) => {
  const { userId } = req.body; // id ë°›ì•„ì˜¤ê¸°
  const sql = `SELECT * FROM channels WHERE user_id = ?`;

  conn.query(sql, userId, (err, results) => {
    // sql ì—ëŸ¬
    if (err) {
      return res.status(400).json(err);
    }
    // ê²°ê³¼ ê°’ì´ ìˆìœ¼ë©´ ë°˜í™˜!
    if (results.length > 0) {
      res.status(200).json({ isSuccess: true, results: results });
    } else {
      channelNotFound(res);
    }
  });
});
```
