## ğŸ“Â Router

ì„œë²„ì—ì„œ routerëŠ” ìš”ì²­(request)ì˜ urlì— ë”°ë¼ ì ì ˆí•œ ê²½ë¡œ(route)ë¥¼ ì •í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.

```jsx
const express = require("express");
const router = express.Router();

router.get("/", (req, res) => {
  res.send("Hello, World !");
});

module.exports = router;
```

express ëª¨ë“ˆì˜ `Router()` ë¥¼ ì´ìš©í•´ì„œ ë¼ìš°í„°ë¥¼ ë§Œë“¤ê³ , ê²½ë¡œë¥¼ ì§€ì •í•´ì¤€ë‹¤.

ì´ í›„ app.jsì—ì„œ ë¼ìš°í„°ë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•œë‹¤.

```jsx
const indexRouter = require("./routes/index");

app.use("/", indexRouter);
```

routerë¥¼ ì—°ê²°í•  ë•Œ use()ì— ì²«ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬í•˜ëŠ” ê²½ë¡œëŠ” baseUrlì´ë‹¤.

<br/>

## ğŸ“Â ë¯¸ë‹ˆ í”„ë¡œì íŠ¸: Router í™œìš©

ë¨¼ì € ê¸°ì¡´ì˜ `users.js` , `channels.js` ëŠ” appì„ ê°ê° ì‚¬ìš©í•˜ì—¬ ë‹¨ì ˆëœ ìƒíƒœì˜€ë‹¤.

```jsx
const express = require("express");
const app = express();
const port = 8888;

app.listen(port, () => console.log(`Server listening on ${port}...`));

app.use(express.json());

/* ----- ë¡œê·¸ì¸ API ----- */
app.post("/login", (req, res) => {
  // ....
});
```

```jsx
const express = require("express");
const app = express();
const port = 8888;

app.listen(port, () => console.log(`Server listening on ${port}...`));

app.use(express.json());

/* ----- ì±„ë„ ìƒì„± API ----- */
app.post((req, res) => {
  // ...
});
```

ìš°ì„  ê° íŒŒì¼ì˜ `app` ì„ `router` ë¡œ ë°”ê¿”ì£¼ê³ , ì„œë²„ ì‹¤í–‰ ì½”ë“œëŠ” ì œê±°í•œë‹¤.

ê·¸ë¦¬ê³  exportë¥¼ í•´ì£¼ë©´ ë!

```jsx
const express = require("express");
const router = express.Router();

router.use(express.json());

/* ----- ë¡œê·¸ì¸ API ----- */
router.post("/login", (req, res) => {
  // ....
});

module.exports = router;
```

`app.js` ì—ì„œëŠ” ì„œë²„ ì‹¤í–‰ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ , ìš”ì²­ì„ ì²˜ë¦¬í•  ê° ë¼ìš°í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì—°ê²°í•œë‹¤.

```jsx
const express = require("express");
const app = express();
const port = 8888;

app.listen(port, () => console.log(`Server listening on ${port}...`));

// router ê°€ì ¸ì˜¤ê¸°
const userRouter = require("./routes/users");
const channelRouter = require("./routes/channels");

// routing ì²˜ë¦¬í•˜ê¸°
app.use("/", userRouter);
app.use("/channels", channelRouter);
```

<br/>

## ğŸ“Â ë¯¸ë‹ˆ í”„ë¡œì íŠ¸: ERD ì„¤ê³„

ì§€ê¸ˆê¹Œì§€ êµ¬í˜„í•œ ê²ƒì„ ê¸°ë°˜ìœ¼ë¡œ ERDë¥¼ ì„¤ê³„í–ˆë‹¤.

ì•„ì§ APIì—ëŠ” ë°˜ì˜ì´ ë˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ ìœ ì €ì™€ ì±„ë„ì„ 1:N ê´€ê³„ë¡œ ì—°ê²°í–ˆê³ , ì±„ë„ì—ëŠ” êµ¬ë…ì ìˆ˜ì™€ ì˜ìƒ ìˆ˜ë¥¼ ì¶”ê°€í–ˆë‹¤.

<img width="550" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-03-26 á„‹á…©á„Œá…¥á†« 11 56 57" src="https://github.com/JIMIN1020/dev-study-note/assets/121474189/818f873a-75cc-4e43-8837-ac8fc2390bc0">

<br/>

## ğŸ“Â ë¯¸ë‹ˆ í”„ë¡œì íŠ¸: API ìˆ˜ì •

ì„¤ê³„í•œ ERDë¥¼ ê¸°ë°˜ìœ¼ë¡œ APIë¥¼ ì ì ˆí•˜ê²Œ ìˆ˜ì •í•  ê²ƒì´ë‹¤.

### âœ”ï¸Â ì±„ë„ ìƒì„± API

ì–´ë–¤ ìœ ì €ê°€ ìƒì„±í•œ ì±„ë„ì¸ì§€ ì‹ë³„í•˜ê¸° ìœ„í•´ `userId`ë¥¼ ì¶”ê°€ë¡œ ì „ë‹¬ë°›ë„ë¡ ìˆ˜ì •í•œë‹¤.

ì±„ë„ ìƒì„± ì‹œ ì „ë‹¬í•˜ëŠ” ìœ ì € idëŠ” jwt í† í°ì„ í™œìš©í•˜ì—¬ í—¤ë”ì— ë„£ì–´ ë³´ë‚´ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‚˜, ì§€ê¸ˆì€ ê¸°ì´ˆì´ê¸° ë•Œë¬¸ì— bodyì— ë‹´ì•„ì„œ ë³´ëƒ„!

requestì— `userId`, `channelTitle` ì´ ê°ê° ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•œ í›„, dbì— ë“±ë¡í•˜ë„ë¡ ìˆ˜ì •í–ˆë‹¤.

```jsx
.post((req, res) => {
    const { userId, channelTitle } = req.body;

    if (userId && channelTitle) {
      const id = db.size + 1; // id êµ¬í•˜ê¸°
      db.set(id, { userId, channelTitle }); // dbì— ë“±ë¡

      res.status(201).json({
        isSuccess: true,
        message: `${db.get(id).channelTitle} ì±„ë„ì„ ì‘ì›í•©ë‹ˆë‹¤!`,
      });
    } else {
      // ìš”ì²­ ê°’ì´ ì—†ëŠ” ê²½ìš°
      res.status(400).json({
        isSuccess: false,
        message: `ìš”ì²­ ê°’ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`,
      });
    }
  })
```

### âœ”ï¸Â ì±„ë„ ì „ì²´ ì¡°íšŒ API

ì¡°íšŒë¥¼ ìš”ì²­í•œ ìœ ì €ì˜ ì±„ë„ë§Œ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ë§ˆì°¬ê°€ì§€ë¡œ `userId` ë¥¼ ì¶”ê°€ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

ì´ë•Œ ì±„ë„ì„ ì¡°íšŒí•˜ë ¤ë©´ ë§ˆì´í˜ì´ì§€ì—ì„œ â€˜ì±„ë„ ê´€ë¦¬â€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼í•˜ê¸° ë•Œë¬¸ì— userIdëŠ” í•­ìƒ ìœ íš¨í•˜ë‹¤ê³  ê°€ì •í–ˆë‹¤.

â†’ ëŒ€ì‹  body ê°’ì— userIdê°€ ì—†ëŠ” ê²½ìš°ëŠ” ì²´í¬! (ex. ë¡œê·¸ì¸ì´ ë§Œë£Œëœ ìƒíƒœ)

```jsx
.get((req, res) => {
    const id = req.body.userId; // id ë°›ì•„ì˜¤ê¸°

    // idê°€ ìˆë‹¤ë©´?
    if (id) {
      // map -> object arrayë¡œ ë³€ê²½
      const channels = [];
      db.forEach((value, key) => {
        if (value.userId === id) channels.push(value);
      });

      // ì±„ë„ì´ ìˆìœ¼ë©´ ë°˜í™˜! ì—†ìœ¼ë©´ 404
      if (channels.length > 0) {
        res.status(200).json({ isSuccess: true, channels: channels });
      } else {
        res.status(404).json({
          isSuccess: false,
          message: "ì¡°íšŒí•  ì±„ë„ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        });
      }
    } else {
      // userIdê°€ ì—†ëŠ” ê²½ìš° = ë¡œê·¸ì¸ ë§Œë£Œëœ ê²½ìš°, ì˜ëª»ëœ ì ‘ê·¼
      res.status(404).json({
        isSuccess: false,
        message: `ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.`,
      });
    }
  });
```

### âœ”ï¸Â íšŒì›ê°€ì… API

íšŒì›ê°€ì… ì‹œì—” userIdë¥¼ ì´ìš©í•˜ì—¬ dbì— ì •ë³´ë¥¼ ë“±ë¡í•˜ë„ë¡ ìˆ˜ì •!

```jsx
router.post("/join", (req, res) => {
  const { userId } = req.body; // ì‹ ê·œ ìœ ì € ì •ë³´

  // íšŒì› ê°€ì…í•  ìœ ì € ì •ë³´ê°€ ìˆë‹¤ë©´? ë“±ë¡!
  if (Object.keys(req.body).length > 0) {
    db.set(userId, req.body);

    res.status(201).json({
      isSuccess: true,
      message: `${db.get(userId).name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`,
    });
  }
  // ì—†ë‹¤ë©´? ì—ëŸ¬ ì‘ë‹µ!
  else {
    res.status(400).json({
      isSuccess: false,
      message: `ìš”ì²­ ê°’ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.`,
    });
  }
});
```

### âœ”ï¸Â íšŒì› ê°œë³„ ì¡°íšŒ API

ê°œë³„ ì¡°íšŒë¥¼ í•  ë• ê°€ì… ì‹œ ì…ë ¥í•˜ì˜€ë˜ userIdë¥¼ ì´ìš©í•˜ì—¬ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

```jsx
router.route("/users").post((req, res) => {
  const { userId } = req.body; // ì‹ ê·œ ìœ ì € ì •ë³´

  // ìœ ì € ì •ë³´ê°€ ìˆë‹¤ë©´? ë°˜í™˜!
  if (db.get(userId)) {
    res.status(200).json({
      isSuccess: true,
      userData: db.get(userId),
    });
  }
  // ì—†ë‹¤ë©´? ì—ëŸ¬ ì‘ë‹µ!
  else {
    res.status(404).json({
      isSuccess: false,
      message: `${id}ì— í•´ë‹¹í•˜ëŠ” ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`,
    });
  }
});
```
